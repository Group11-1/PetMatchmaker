<button (click)="logout()">Exit Questionnaire</button>

<div *ngIf="!loading && questions.length > 0; else loadingTemplate">
  <h2>{{ questions[currentQuestionIndex].question }}</h2>

  <!-- Check if there are choices -->
  <div
    *ngIf="questions[currentQuestionIndex].choices.length > 0; else noOptions"
  >
    <div *ngFor="let choice of questions[currentQuestionIndex].choices">
      <p>
        Choice: {{ choice.choice }}, Next Question ID:
        {{ choice.next_question_id }}
      </p>
    </div>
    <!-- Multiple-Choice Format -->
    <div *ngIf="questions[currentQuestionIndex].format === 'multiple_choice'">
      <div *ngFor="let choice of questions[currentQuestionIndex].choices">
        <input
          type="radio"
          name="question{{ questions[currentQuestionIndex].id }}"
          [value]="choice.choice"
          (click)="answerQuestion(choice.choice, choice.next_question_id)"
        />
        {{ choice.choice }}
      </div>
    </div>

    <!-- Dropdown Format -->
    <div *ngIf="questions[currentQuestionIndex].format === 'dropdown'">
      <select (change)="onDropdownChange($event)">
        <option value="" disabled selected>Select an option</option>
        <option
          *ngFor="let choice of questions[currentQuestionIndex].choices"
          [value]="choice.choice"
        >
          {{ choice.choice }}
        </option>
      </select>
    </div>

    <!-- Checkbox format -->
    <div *ngIf="questions[currentQuestionIndex].format === 'checkbox'">
      <div *ngFor="let choice of questions[currentQuestionIndex].choices">
        <input
          type="checkbox"
          [value]="choice.choice"
          (change)="onCheckboxChange(choice, $event)"
        />
        {{ choice.choice }}
      </div>
    </div>

    <!-- Free Response Format -->
    <div *ngIf="questions[currentQuestionIndex].format === 'free_response'">
      <input type="text" placeholder="Type your answer here..." />
    </div>

    <!-- Fallback for other question formats (e.g., dropdown, checkbox) -->
    <div
      *ngIf="
        questions[currentQuestionIndex].format !== 'multiple_choice' &&
        questions[currentQuestionIndex].format !== 'dropdown' &&
        questions[currentQuestionIndex].format !== 'checkbox' &&
        questions[currentQuestionIndex].format !== 'free_response'
      "
    >
      <div *ngFor="let choice of questions[currentQuestionIndex].choices">
        <button
          (click)="answerQuestion(choice.choice, choice.next_question_id)"
        >
          {{ choice.choice }}
        </button>
      </div>
    </div>

    <!-- Show Next Button only when at least one checkbox is selected -->
    <div
      *ngIf="
        selectedChoices.length > 0 &&
        questions[currentQuestionIndex].format === 'checkbox'
      "
    >
      <button
        (click)="handleCheckboxNext()"
        [disabled]="selectedChoices.length === 0"
      >
        Next
      </button>
    </div>

    <!-- Show Submit Button only for last free response question -->
    <div
      *ngIf="
        selectedChoices.length > 0 &&
        questions[currentQuestionIndex].format === 'free_response'
      "
    >
      <button [disabled]="selectedChoices.length === 0">Submit</button>
    </div>
  </div>
</div>

<ng-template #noOptions>
  <p>No options available for this question.</p>
</ng-template>

<ng-template #loadingTemplate>
  <p>Loading questions...</p>
</ng-template>
